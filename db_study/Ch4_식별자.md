# 공부한 내용


## 1. 식별자 개념

식별자 → 사실상 Key와 같은 개념이다. 하지만 논리적 영역에서는 “식별자”를 쓰고, 물리적 영역에서는 “Key”를 쓴다.

## 2. 식별자의 특징

### 주식별자(=PK)

- 유일성 → 식별자로 인해 인스턴스들이 구분이 되야 한다.
- 최소성 → 식별자는 가능한 가장 작은 개념으로 사용한다.
    - 이미 A라는 속성으로 식별자 기능을 할 수 있는데, 굳이 A + B를 할 필요가 없음.
- 불변성 → 식별자값은 변하면 안된다.
- 존재성 → 식별자값은 NULL일 수 없다.

- 외부식별자(=FK)는 주식별자와는 또 다른 특성을 가지고 있다.

## 3. 식별자의 분류 및 표기

- 주식별자와 보조식별자
- 내부식별자와 보조식별자

더 이상의 상세한 분류는 크게 의미가 없는 것 같아서 제외했다. 표기의 경우, 주민번호(PK), 사원번호(FK) 이런 식으로 표기한다.

## 4. 주식별자를 고르는 기준

- 해당 업무에서 자주 이용되는 속성을 사용
    - 자주 쓰고, UNIQUE한 속성을 사용한다.

- 가능하면 명칭, 내역 등과 같이 이름으로 기술 X
    - 웬만하면 이름같은 거 쓰지 말고, 일련번호/코드 등을 사용하도록 한다.

- 복합으로 주식별자를 구성할 때, 너무 많은 속성을 포함 X
    - 주식별자로 쓸만한 속성이 너무 많으면 그냥 걔네를 합쳐서 하나의 속성으로 만들어버린다.
    - PK가 늘어난다는 것은, 즉 SQL 쿼리 하나하나마다 해당 속성들이 일치하는지 전부 확인해야한다는 것을 의미하므로, 쿼리문 자체가 많이 복잡해진다.

## 5. **식별자관계와 비식별자관계에 따른 식별자**

이 부분은 내용이 좀 많이 어려운 감이 있어서 다소 스킵한 부분이 있다. 그냥 알잘딱깔센으로 학습하려고 한다… 어차피 다 외우지도 못할 것 같고 나중에 필요하면 그 때 찾아봐도 늦지 않을 것 같다.

### 식별자 관계

- 부모 엔티티와 자식 엔티티가 있을 때, 부모 엔티티로부터 자식이 받은 FK를 그대로 자신의 PK로 이용하는 경우를 식별자 관계라고 한다. → 부모의 PK를 자식이 그대로 자신의 PK로 상속
- 이 경우, PK가 NULL값이 될 수는 없으므로 꼭 부모 엔티티가 생기고 자식엔티티가 생긴다.
- ex. “사원”이라는 엔티티 없이는 “발령”이라는 엔티티가 생길 수 없다.

### 비식별자 관계

- 반대로 PK로 사용하지 않으면 그냥 비식별자 관계이다.
- 대체로 부모 엔티티가 사라져도 딱히 자식 엔티티에게 영향이 없는 경우이다.

### 식별자 관계의 단점

- 식별자 관계는 상속이 많아질수록 식별자가 누적되서 나중에는 자식의 PK가 매우 많아진다는 점이다.
- PK가 많아질 경우, 앞에서 언급했듯이 쿼리 길이가 상당히 길어지므로 좋지 않다.
    - 일단 쿼리 작성 자체가 복잡하다.
    - 그리고 개발자가 실수를 할 가능성이 높아진다.

> PK가 늘어난다는 것은, 즉 SQL 쿼리 하나하나마다 해당 속성들이 일치하는지 전부 확인해야한다는 것을 의미하므로, 쿼리문 자체가 많이 복잡해진다.
>

### 비식별자 관계의 단점

- 비식별자는 부모의 PK를 받지 않기 때문에, 자식에서 부모의 정보를 찾지 못하고 **부모를 직접 찾아가야 한다**라는 단점이 있다.
- 역시 자식과 부모 테이블을 연결해야 하므로 조인을 많이 해야 해서 좋지 않다.

### 그렇다면 어떠한 기준으로 식별관계와 비식별관계를 결정해야 하는가?

아래 흐름도를 참고하여 비식별관계를 선정한다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/5486ac02-837a-4340-b853-a8cd7b03f65f/fcab6405-6e28-435e-b0dc-dc8ab09b97b7/Untitled.png)

1. 관계의 강/약을 분석하라는 것은, 말 그대로 부모와 자식이 얼마나 연관성이 있는지를 보는 것이다.
2. 자식테이블이 부모의 PK만으로는 부족해서 독립된 PK를 가져야 할 경우를 뜻한다.
3. 반복해서 등장하는 부분인데, PK가 늘어나서 SQL 쿼리가 너무 복잡해질 때를 뜻한다.

# 어려웠던 내용


> 주식별자를 구성하는 속성의 수는 유일성을 만족하는 최소의 수가 되어야 한다.
>

Q. 이게 도대체 무슨 말인지?

A. 식별자를 가능한 가장 조그맣게 사용한다는 얘기다. 예를 들어, 이미 A라는 속성으로 식별자 기능을 할 수 있는데, 굳이 A + B를 할 필요가 없다는 얘기다.

> 주식별자로 선정하기 위한 속성이 복합으로 구성되어 주식별자가 될 수 있을 때 가능하면 주식별자 선정하기 위한 속성의 수가 많지 않도록 해야 한다. 그러나 만약 주식별자로 선정된 속성들이 자신이 가지고 있는 자식엔터티로부터 손자엔터티, 그리고 증손자엔터티까지 계속해서 상속이 되는 속성이고 복잡한 데이터 모델이 구현되어 물리데이터베이스에서 조인으로 인한 성능저하가 예상되는 모습을 가지고 있다면 속성의 반정규화 측면에서 하나의 테이블에 많은 속성이 있는 것이 인정될 수도 있다.
>

Q. 이것도 무슨 말인지…

A. 반정규화의 상황에서는 주식별자 속성이 많아도 괜찮다.

✅ 반정규화란?: 상속되는 엔티티가 많아지면서 공통된 속성이 여러 엔티티에 흩어진다면 조인 시 성능저하 문제가 발생하는데, 이에 따라 공통된 속성들을 따로 엔티티를 만들어 중복으로 저장하는 방식을 말한다.

# 궁금한 내용 / 부족한 내용


Q. 논리적/물리적 데이터 모델이란 것은 어떻게 구분하는 것인지?

A. 흔히 데이터 모델은 개념적 → 논리적 → 물리적 모델로 나뉜다.

- 논리적 모델의 경우, 흔히 말하는 ERD를 생각하면 된다.
- 물리적 모델의 경우, ERD와 비슷하나 실제 데이터베이스에 매핑할 때 고려할만한 상세한 정보들이 추가된다. 문법 역시 DB 종류에 맞게 준수해야 한다.

Q. ERD에서 표시되는 실선과 점선의 차이는 무엇인지?

A. 실선은 식별관계, 점선은 비식별관계이다.

# 느낀점


PK와 FK에 관련된 부분이 어려울 줄은 예상하고 있었는데, 솔직히 말해서 대가리 깨지는 줄 알았다.

물론 내가 내 손으로 DB를 설계할 일이 많지는 않겠지만, 일단 ERD를 보고 이해할 줄은 알아야 하고, 또 사용하다가 뭔가 불편하거나 비효율적이라 생각되면 구조를 개선해야 할텐데 이런 걸 능숙하게 할 때까지 아직 많이 부족하다는 생각이 들었다.

일단은 개념적인 부분은 어느정도 머릿속에 넣어뒀으니, 실전을 겪어보면서 많은 테이블들을 접하고 이게 맞는 구조인지 계속해서 고민해봐야 할 것 같다.