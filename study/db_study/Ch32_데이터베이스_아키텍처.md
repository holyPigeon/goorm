# 공부한 내용

## 1. **아키텍처 개관**

### DB란 무엇인가

- 데이터베이스의 설명은 벤더마다 다르지만, 오라클에서는 보통
    - 데이터베이스 → 디스크에 저장된 데이터 집합
    - 인스턴스 → SGA 공유 메모리 영역 + 이에 엑세스하는 프로세스의 집합

라고 한다.

기본적으로는 1개의 데이터베이스 ↔ 1개의 인스턴스가 대응되지만, 클러스터 환경에서는

1개의 데이터베이스 ↔ 여러 개의 인스턴스가 대응될 수 있다.

## 2. 프로세스

프로세스는 서버 프로세스(Server Processes)와 백그라운드 프로세스(Background Processes) 집합으로 나뉜다.

- 서버 프로세스 → 전면에 나서 사용자가 던지는 각종 명령을 처리
- 백그라운드 프로세스 → 뒤에서 묵묵히 주어진 역할을 수행한다.

### 서버 프로세스

서버 프로세스는 사용자 프로세스와 통신하면서 사용자의 각종 명령을 처리한다.

- 보다 자세히 설명하자면 다음과 같다.
    - SQL을 파싱하고 필요하면 최적화를 수행
    - 커서를 열어 SQL을 실행하면서 블록을 읽음
    - 읽은 데이터를 정렬해서 클라이언트가 요청한 결과집합을 만듬
    - 만들어진 결과집합을 네트워크를 통해 전송

그냥 DB 처리의 거의 모든 걸 다 한다고 보면 된다.

- 서버 프로세스에는 두 가지 처리 방식이 있다.
    - 전용 서버 방식 → 서버 프로세스가 단 하나의 사용자 프로세스를 위해 전용 서비스를 제공한다.

      (1:1 관계가 여러 개)

    - 공뷰 서버 방식 → 여러 개의 서버 프로세스와 여러 개의 사용자 프로세스가 서로 공유된다.

      (N:N 관계)

### 백그라운드 프로세스

너는 하는 일이 뭐냐

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/5486ac02-837a-4340-b853-a8cd7b03f65f/1f52bdfb-442c-4405-a855-d63fdbac66d4/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-04-07_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.17.22.png)

솔직히 이걸 다 외울 필요는 없을 것 같고, 확실히 백그라운드적인 일들을 도맡아 한다고 보면 될 것 같다.

뭔가 기록, 백업하는 기능이 많다는 생각이 든다. 캐싱이나 추후 복구를 위한 기록이 많은 것 같다.

## 3. 파일 구조

### 데이터 파일

전체적인 구조는 다음과 같다.

![](https://dataonair.or.kr/publishing/img/knowledge/SQL_265.jpg)

1. 블록(=페이지)

전에 디스크 I/O가 블록 단위로 이루어진다는 내용이 나왔는데, 그 블록이 이 블록이다. 데이터를 읽고 쓸 때의 논리적인 단위이다. 블록의 크기는 2KB ~ 64KB 등 다양하게 설정할 수 있다.

성능을 좌우하는 가장 중요한 지표이며, 옵티마이저 또한 성능에 대한 계산을 할 때 블록 개수를 기준으로 판단한다.

2. 익스텐트(Extent)

테이블 스페이스로부터 공간을 할당받는 단위이다. 익스텐트라는 공간의 단위 안에 블록이라는 데이터의 단위가 있다고 생각하면 된다.

3. 세그먼트

여러 개의 익스텐트를 가지고, 그 밑에 블록들을 통한 I/O와 함께 특정 작업을 하는 단위를 뜻한다. 힙 구조, 인덱스 구조 등이 있다.

4. 테이블 스페이스

세그먼트를 담는 컨테이너이다. 간단간단하게 넘어가자.

### **임시 데이터 파일**

말 그대로 임시 데이터 파일이다. 대량의 정렬이나 해시 작업을 수행하다 메모리 공간이 부족해지는 경우, 중간 결과집합을 저장하곤 한다.

### 로그 파일

변경된 데이터를 반영할 때, 보통은 디스크 상의 블록에 기록하는 것보다(랜덤 I/O 방식) 로그로 기록하는 것이(Append 방식) 훨씬 빠르다.

따라서 DBMS는 데이터 변경이 일어날 때, 일단은 로그로 기록하고, 나중에 일괄적으로(Batch 방식) 디스크 상의 블록에 기록한다.

