# 공부한 내용

## 1. 옵티마이저 소개

### 옵티마이저란?

소개하지 않아도 된다… 이미 잘 알고 있기 때문에…

→ SQL을 가장 빠르고 효율적으로 처리할수 있도록 최적의 실행계획을 세워주는 DBMS 내부의 핵심 엔진이다.

### 옵티마이저의 종류

- 규칙 기반 옵티마이저
    - 정해진 규칙에 따라 실행계획을 결정한다.
- 비용 기반 옵티마이저
    - 특정 지표들을 통해 계산된 비용에 따라 실행계획을 결정한다.
    - 판단 기준이 되는 지표로는 테이블&인덱스에 대한 통계 정보, 더 들어가자면 하드웨어적 시스템 통계 정보 등이 있다.

최근에는 거의 모든 DBMS에서 비용 기반 옵티마이저를 사용하고 있다.

### SQL 최적화 과정

SQL의 최적화 과정은 다음과 같다.

![](https://dataonair.or.kr/publishing/img/knowledge/SQL_286.jpg)

1. 사용자로부터 입력받은 SQL을 파싱한다.
2. 옵티마이저가 실행계획을 생성한다.
    1. 사용자 쿼리를 번역한다.
    2. 통계정보를 바탕으로 실행계획의 총 비용을 계산해낸다.
    3. 여러가지 후보 실행계획들을 생성해내고, 그 중 가장 적합한 것을 채택한다.
3. 옵티마이저가 생성한 실행계획을 실제 DB 엔진이 사용할 수 있는 코드로 포맷팅한다.
4. SQL을 실행한다.

### 최적화 목표

1. 전체 처리속도 최적화 → 쿼리의 결과집합을 모두 읽으며, 시스템 리소스를 가장 적게 사용하는 실행계획을 선택한다.
2. 최소 응답속도 최적화 → 쿼리의 결과집합을 일부만 읽다가 멈추며, 가장 빠른 응답속도를 낼 수 있는 실행계획을 선택한다.

위 목표는 옵티마이저 모드를 설정함으로써 바꿀 수 있다!

## 2. **옵티마이저 행동에 영향을 미치는 요소**

- SQL과 연산자 형태
    - 결과가 같더라도 SQL을 어떤 형태로 작성했는지, 또는 어떤 연산자를 사용했는지에 따라 달라진다.
- 옵티마이징 팩터
    - 인덱스, IOT, 클러스터링, 파티셔닝, MV 등을 어떻게 구성했는지에 따라 달라진다.
- DBMS 제약 설정
    - 제약 조건이 영향을 미칠 수 있다.
- 옵티마이저 힌트
    - 사용자가 옵티마이저 힌트를 지정하면, 옵티마이저는 본인의 판단보다 힌트를 우선시하게 된다.
- 통계정보
    - 그냥 제일 중요한 요소이다.
- 옵티마이저 관련 파라미터 및 버전
    - 모든 통계정보가 같더라도 파라미터에 따라, 또는 버전 옵티마이저의 동작이 달라질 수 있다.









