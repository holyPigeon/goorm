# 공부한 내용

DBMS가 내부적으로 조인을 어떻게 수행하는지 알아보자!

## 1. NL Join(Nested Loop Join)

### 기본 메커니즘

NL Join의 기본 메커니즘은 중첩 for문과 같다.

```java
for(i=0; i<100; i++){ 
	...
	for(j=0; j<100; j++){ 
		... 
	} 
}
```

예를 들어 조인할 테이블이 3개라고 한다면, 2개의 테이블을 먼저 조인하고 그 다음에 합쳐진 테이블과 나머지 한 테이블을 마저 조인하게 되는데, 이 과정에서 for문이 쓰이게 된다.

### NL Join 수행과정 분석

![](https://velog.velcdn.com/images/eunhye_/post/098b3246-35f0-4e46-9b9c-71094e41f38e/image.png)

1. 먼저 선행 테이블에서 조건에 맞는 행을 스캔한다.
2. 선행 테이블의 조인 키를 통해 후행 테이블에도 조인 키가 존재하는지 확인한다.
3. 후행 테이블 인덱스에 선행 테이블의 조인 키가 존재하는지 확인한다.

   (만약 없다면 선행 테이블 데이터는 그대로 필터링한다.)

4. 조인 키가 존재한다면 인덱스의 레코드 식별자를 통해 후행 테이블에 엑세스한다.

### NL Join의 특징

- NL Join의 특징은 다음과 같다.
    - 선행 테이블을 Full Scan하기 때문에 선행 테이블의 크기가 작을수록 유리하다.
    - 후행 테이블에 대해서는 반드시 인덱스가 있어야 조인이 가능하다.
        - 따라서 인덱스 구성 전략의 영향을 크게 받는다. 인덱스가 있는지 없는지, 또는 해당 인덱스의 칼럼 구성이 어떤지에 따라 조인 효율이 크게 달라진다.
    - 랜덤 엑세스 방식을 사용하므로, 처리 방식이 좁을수록 유리하다.

## 2. Sort Merge Join

### 기본 메커니즘

Sort Merge Join은 말 그대로 조인 컬럼을 기준으로 데이터를 정렬하여 조인을 수행한다.

### Sort Merge Join의 특징

NL Join이 랜덤 엑세스 방식을 사용하는 반면, Sort Merge Join은 스캔 방식을 사용한다.

→ 따라서 넓은 범위의 조인을 처리할 때 유용하다.

사실 성능상으로는 Sort Merge Join보다는 Hash Join이 더 유리하긴 하지만, Sort Merge Join의 경우 동등 조인뿐만 아니라 비동등 조인 작업 역시 가능하다는 장점이 있다.

![](https://velog.velcdn.com/images/eunhye_/post/60b80d9f-e301-4943-9ca8-a8b37a89a93a/image.png)

- 인덱스가 없어도 사용 가능하다.
- 대부분의 경우에서는 Hash Join이 더 우수한 성능을 보인다.
- 두 테이블의 사이즈가 비슷한 경우에 유리하다.

## 3. Hash Join

해싱 기법을 이용한 Join 방법이다. 조인할 두 테이블 중 하나를 해시 테이블로 지정하고, 각 조인 키를 Hash 알고리즘을 이용해 비교, 매치하여 결과값을 얻는다.

동등비교 조인에서만 사용 가능하며, 대량의 데이터 처리에 적합하다.

![](https://velog.velcdn.com/images/eunhye_/post/377d8aa3-819c-4a0c-82c8-cd51723b60d3/image.png)

- 조인 칼럼의 인덱스가 없어도 사용 가능하다!
- 언급했다시피 동등조인에서만 사용 가능하다.

## 4. Scalar Subquery

서브쿼리 중에서 여러 개의 값이 아닌 단 하나의 값을 리턴하는 서브쿼리를 Scalar Subquery라고 한다.

내부적으로 캐싱 기법이 작용되서 효율적으로 처리할 수 있다고 하는데 솔직히 무슨 말인지 모르겠다…ㅋㅋㅋ













