# 공부한 내용


## **1. 대량 데이터발생에 따른 테이블 분할 개요**

- 2가지 경우에서 성능 저하가 발생한다.
    - 대량의 데이터를 처리하는 경우 → 인덱스의 Tree 구조가 너무 커져 효율성이 떨어진다.
    - 한 테이블에 컬럼의 양이 지나치게 많은 경우 → 디스크의 여러 블록에 데이터가 저장된다. 로우 체이닝과 로우 마이그레이션 현상이 발생하게 된다.
    - 결과적으로 디스크 I/O량이 많아지게 되면서 성능이 저하된다.

## 2. 테이블에 컬럼이 너무 많으면 뭐가 문제일까?

정확한 의미인지는 모르겠지만, 하나의 row를 불러오려면 해당 row에 있는 모든 컬럼값들에 접근해야 하는데, 만약에 내가 1~2개의 컬럼값에만 접근하고 싶다 하더라도 그게 안되는 것 같다.

이 때, 트랜잭션을 기준으로 자주 접근하는 컬럼값들을 찾은 다음 테이블을 분리해준다면 디스크 I/O가 감소하게 되어 성능이 효과적으로 개선된다.

## 3. 테이블에 데이터가 너~무 많으면 뭐가 문제일까?

그냥 문제다. 아무리 서버 사양이 좋고 인덱스를 잘 생성해준다고 하더라도 SQL 성능이 잘 나오지 않기 때문에, 이 경우에는 파티셔닝으로 테이블을 분리해주는 것이 좋다.

### Range Partition

말 그대로 범위에 따른 파티셔닝 방식이다. 날짜나 숫자값을 기준으로 분리한다. 특정 범위 안에 드는 데이터들을 분리하는 식이다.

삭제도 굉장히 쉬운데, 분리된 테이블을 그냥 DROP하면 된다.

### List Partition

값 각각에 따라 파티셔닝이 되는 방식이다. 어떤 값 목록이 있을 때(ex. 서울, 대구, 대전, 제주) 그 값 목록에 속하는 데이터가 있으면 특정 파티션에 넣는 방식이다.

데이터 보관주기에 따라 삭제할 수는 없다.

### Hash Partition

지정된 Hash 조건에 따라 해슁 알고리즘이 적용되어 테이블이 분리되고, 설계자조차도 어떤 데이터가 어느 테이블에 들어갔느지를 알 수 없다.

역시 데이터 보관주기에 따른 삭제는 불가능하다.

## 4. **테이블에 대한 수평분할/수직분할의 절차**

다음과 같은 절차가 있다.

1.  데이터 모델링을 완성한다.
2.  데이터베이스 용량산정을 한다.
3.  대량 데이터가 처리되는 테이블에 대해서 트랜잭션 처리 패턴을 분석한다.
4.  칼럼 단위로 집중화된 처리가 발생하는지, 로우단위로 집중화된 처리가 발생되는지 분석하여 집중화된 단위로 테이블을 분리하는 것을 검토한다.

- 데이터베이스 용량산정의 경우, 어떤 테이블에 대용량 데이터가 들어있는지 확인하는 것이다.
- 트랜잭션 처리 패턴을 분석함으로서 해당 테이블에서 어떤 칼럼, 또는 어떤 로우에 트래픽이 몰리는지 확인할 수 있다. 이를 바탕으로 테이블을 분리한다.

# 어려웠던 내용


- 테이블에 대용량 데이터가 들어갔을 때
- 한 테이블에 칼럼이 너무 많을 떄

두 경우에서 디스크 I/O가 증가하게 되어 성능 저하가 된다는 내용이 있었는데 정확한 과정이 잘은 이해가 가지 않았다.

첫 번째의 경우 트리 구조가 너무 커진다는 것은 트리의 높이가 깊어져, 밑에까지 접근하는데 더 디스크 I/O가 많이 발생한다는 것 같고,

두 번째의 경우는 칼럼이 많을수록 디스크 상의 블록을 더 많이 차지해서 디스크 I/O가 많이 발생한다는 것으로 이해했다.

# 궁금한 내용 / 부족한 내용


## Q1. 트랜잭션이란 단어가 계속 나오는데 무슨 뜻인지?

뭔가 데이터를 사용할 때 자주 쓰이는 용어 같아서 일단은 “트래픽”과 비슷한 말이라고 이해했다.

더 자세히 알아보니, 트랜잭션은 데이터를 처리할 때의 작업 단위라고 한다.

> 예를 들어 특정 데이터를 수정하는 작업을 수행했을 때, DB의 물리적 공간 속에서

1. 데이터가 수정될 위치를 확인
2. 원래 있던 데이터가 지워지고
3. 새로 삽입할 데이터를 해당 자리에 삽입

이런 일련의 과정들이 있을텐데, 트랜잭션은 이러한 과정들을 한꺼번에 진행시키고, 그 중에 하나라도 실패하면 이전 상태로 롤백(되돌리기)시킬 수 있다.

만약 트랜잭션이 없는데 이 중에서 3번만 실패했다면, 이미 원래 있는 데이터는 지워졌고 복구가 안되기 때문에 데이터 무결성, 일관성과 관련된 문제가 발생하게 된다.
>

## Q2. 트랜잭션 처리 패턴을 어떻게 분석할까?

테이블 분할을 하려면 어떤 로우나 칼럼에 트랜잭션이 집중되는지를 알아야 한다. 그렇다면 이러한 정보들은 어떻게 모니터링할 수 있는 걸까?

각 DB 제품마다 전용 툴을 제공하고 있다.

- Oracle의 AWR(자동 워크로드 저장소) 리포트
- SQL Server의 DMV(동적 관리 뷰)
- MySQL의 Performance Schema

MySQL을 자주 써서 Performance Schema에 대해 자세히 알아보려고 했는데, 생각보다 기능이 너무 많기도 했고, GUI가 아니어서 이해하기가 좀 힘들었다. 이 부분은 나중에 자세히 알아봐야할 것 같다..

# 느낀점


전 챕터에서 DB 파티셔닝이라는 단어가 나와서 미리 찾아봤는데, 해당 개념에 바로 나와서 이해하기 훨씬 쉬웠던 것 같다.

그리고 잘 모르는 상태에서 “카카오톡 대화 데이터를 날짜별로 파티셔닝한다”라는 예시를 하나 들었었는데, 이것도 Range Partition이라는 개념으로 그대로 나와서 좀 신기했다.

뭔가 하면 할수록 느끼는 건데 딱 학습 자료만 보고 끝나는 게 아니라 이런 식으로 추가 자료를 찾아보는 게 공부에 굉장히 도움이 되는 것 같다.

다만 데이터 저장 관련 내용에서 나온 “인덱스 트리 구조”, 그리고 “디스크의 블록” 개념에 대해서는 후에 더 자세히 알아볼 필요가 있을 것 같다.